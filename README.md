# ProcessingOfTheEvent
```
Процедура ОбработкаПроведения(Отказ, Режим)
	// регистр ДвиженияДС Расход 
	Если СтатусДокумента=Перечисления.СтатусыДокументов.Согласован Тогда
		Движения.ДвиженияДС.Записывать = Истина;
		Движение = Движения.ДвиженияДС.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		Движение.Период = Дата;        
		Движение.Документ=Ссылка;     
		Движение.Договор=Договор;
		Движение.Контрагент=Контрагент; 
		Движение.ВидОперации=СтатьяРасходаДС;
		Движение.ДенежныеСредства = СуммаРасхода;
	КонецЕсли;

	//запрос на выборку имеющихся записей из регистра сведений "Статусы документа" по ссылке на документ заказа
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтатусыДокументовСрезПоследних.Статус КАК Статус
		|ИЗ
		|	РегистрСведений.СтатусыДокументов.СрезПоследних КАК СтатусыДокументовСрезПоследних
		|ГДЕ
		|	СтатусыДокументовСрезПоследних.Документ = &Документ";
	Запрос.УстановитьПараметр("Документ", Ссылка);
	РезультатЗапроса = Запрос.Выполнить();
	
	//проверка на наличие записей в результате запроса
	Если РезультатЗапроса.Пустой() Тогда
		ЗаписатьДвиженияСтатуса();
	Иначе
		Выборка=РезультатЗапроса.Выбрать();
		Выборка.Следующий();
		Если Выборка.Статус<>СтатусДокумента Тогда
			ЗаписатьДвиженияСтатуса();
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры     

//Процедура ЗаписатьДвиженияСтатуса() нужна для записи изменений статуса заказа в регистр сведений "История заказа"
//Входящие параметры: -
//Исходящие параметры: - 

Процедура ЗаписатьДвиженияСтатуса()
	Запись=РегистрыСведений.СтатусыДокументов.СоздатьМенеджерЗаписи();
	Запись.Документ=Ссылка;
	Запись.Статус = СтатусДокумента;     
	Запись.Период=ТекущаяДата();  
	Запись.Записать();
КонецПроцедуры
```
